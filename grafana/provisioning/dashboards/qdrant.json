{
  "title": "Qdrant Dashboard",
  "uid": "qdrant-pro-fixed",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 2,
  "refresh": "30s",
  "time": { "from": "now-24h", "to": "now" },
  "__requires": [
    {"type":"grafana","id":"grafana","name":"Grafana","version":"10.4.0"},
    {"type":"datasource","id":"prometheus","name":"Prometheus","version":"2.9.0"},
    {"type":"panel","id":"stat","name":"Stat","version":""},
    {"type":"panel","id":"timeseries","name":"Time series","version":""},
    {"type":"panel","id":"bargauge","name":"Bar gauge","version":""},
    {"type":"panel","id":"table","name":"Table","version":""}
  ],
  "panels": [
    { "type":"row", "title":"Vue d'ensemble", "gridPos":{"h":1,"w":24,"x":0,"y":0}},

    {
      "type":"stat", "title":"Qdrant UP",
      "gridPos":{"h":4,"w":4,"x":0,"y":1},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"max(up{job=\"qdrant\"})"}],
      "fieldConfig":{"defaults":{"mappings":[{"type":"value","options":{"0":{"text":"DOWN","color":"red"},"1":{"text":"UP","color":"green"}}}],"thresholds":{"mode":"absolute","steps":[{"color":"red"},{"color":"green","value":1}]}}}
    },
    {
      "type":"stat","title":"Uptime (h)",
      "gridPos":{"h":4,"w":4,"x":4,"y":1},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {
          "refId":"A",
          "expr":"(time() - max(container_start_time_seconds{container_label_com_docker_compose_service=\"qdrant\"})) / 3600"
        }
      ],
      "fieldConfig":{"defaults":{"unit":"hours","decimals":1}}
    },
    {
      "type":"stat","title":"Collections",
      "gridPos":{"h":4,"w":4,"x":8,"y":1},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"max(collections_total) or vector(0)"}],
      "fieldConfig":{"defaults":{"decimals":0}}
    },
    {
      "type":"stat","title":"Vectors (total)",
      "gridPos":{"h":4,"w":4,"x":12,"y":1},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"max(collections_vector_total) or vector(0)"}],
      "fieldConfig":{"defaults":{"decimals":0}}
    },
    {
      "type":"bargauge","title":"RPS par méthode (5m)",
      "gridPos":{"h":8,"w":8,"x":16,"y":1},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"sum by (method) (rate(rest_responses_total[5m]))"}],
      "fieldConfig":{"defaults":{"unit":"req/s","min":0}},
      "options":{"displayMode":"lcd","orientation":"horizontal"}
    },

    { "type":"row", "title":"Ressources conteneur (cAdvisor)", "gridPos":{"h":1,"w":24,"x":0,"y":5}},

    {
      "type":"timeseries","title":"CPU % (qdrant)",
      "gridPos":{"h":8,"w":8,"x":0,"y":6},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {
          "refId":"A",
          "expr":"sum by (container_label_com_docker_compose_service) (rate(container_cpu_usage_seconds_total{container_label_com_docker_compose_service=\"qdrant\"}[5m])) * 100"
        }
      ],
      "fieldConfig":{"defaults":{"unit":"percent","min":0}}
    },
    {
      "type":"timeseries","title":"Mémoire (Working Set)",
      "gridPos":{"h":8,"w":8,"x":8,"y":6},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {
          "refId":"A",
          "expr":"sum by (container_label_com_docker_compose_service) (container_memory_working_set_bytes{container_label_com_docker_compose_service=\"qdrant\"})"
        }
      ],
      "fieldConfig":{"defaults":{"unit":"bytes"}}
    },
    {
      "type":"timeseries","title":"Réseau (Rx/Tx bytes/s)",
      "gridPos":{"h":8,"w":8,"x":16,"y":6},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {"refId":"A","expr":"sum by (container_label_com_docker_compose_service) (rate(container_network_receive_bytes_total{container_label_com_docker_compose_service=\"qdrant\"}[5m]))"},
        {"refId":"B","expr":"sum by (container_label_com_docker_compose_service) (rate(container_network_transmit_bytes_total{container_label_com_docker_compose_service=\"qdrant\"}[5m]))"}
      ],
      "fieldConfig":{"defaults":{"unit":"Bps"}}
    },
    {
      "type":"timeseries","title":"I/O disque (Read/Write B/s)",
      "gridPos":{"h":8,"w":12,"x":0,"y":14},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {"refId":"A","expr":"sum by (container_label_com_docker_compose_service) (rate(container_fs_reads_bytes_total{container_label_com_docker_compose_service=\"qdrant\"}[5m]))"},
        {"refId":"B","expr":"sum by (container_label_com_docker_compose_service) (rate(container_fs_writes_bytes_total{container_label_com_docker_compose_service=\"qdrant\"}[5m]))"}
      ],
      "fieldConfig":{"defaults":{"unit":"Bps"}}
    },

    { "type":"row", "title":"Latence & perfs Qdrant", "gridPos":{"h":1,"w":24,"x":0,"y":22}},

    {
      "type":"timeseries","title":"Latence (p50/p95/p99) — secondes",
      "gridPos":{"h":8,"w":12,"x":0,"y":23},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[
        {"refId":"A","expr":"histogram_quantile(0.50, sum by (le) (rate(rest_responses_duration_seconds_bucket[5m])))"},
        {"refId":"B","expr":"histogram_quantile(0.95, sum by (le) (rate(rest_responses_duration_seconds_bucket[5m])))"},
        {"refId":"C","expr":"histogram_quantile(0.99, sum by (le) (rate(rest_responses_duration_seconds_bucket[5m])))"}
      ],
      "fieldConfig":{"defaults":{"unit":"s"}}
    },
    {
      "type":"timeseries","title":"RPS par endpoint (top 10)",
      "gridPos":{"h":8,"w":12,"x":12,"y":23},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"topk(10, sum by (endpoint) (rate(rest_responses_total[5m])))"}],
      "fieldConfig":{"defaults":{"unit":"req/s","min":0}}
    },
    {
      "type":"table","title":"Erreurs 4xx/5xx par endpoint (15m)",
      "gridPos":{"h":8,"w":24,"x":0,"y":31},
      "datasource":{"type":"prometheus","uid":"Prometheus"},
      "targets":[{"refId":"A","expr":"sum by (endpoint,status) (increase(rest_responses_total{status=~\"4..|5..\"}[15m]))"}],
      "options":{"showHeader":true}
    }
  ]
}

